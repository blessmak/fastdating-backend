<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fast Dating –ú–ì–£</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #fff;
      margin: 20px;
    }
    .profile {
      border: 1px solid #ddd;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      text-align: center;
    }
    .btn {
      padding: 10px 20px;
      background-color: #6c63ff;
      color: white;
      border: none;
      border-radius: 10px;
      margin: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background-color: #584de0;
    }
  </style>
</head>
<body>

<h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Fast Dating –ú–ì–£</h2>
<div id="profileContainer"></div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  let userId = tg.initDataUnsafe.user.id;
  let name = tg.initDataUnsafe.user.first_name || "–ê–Ω–æ–Ω–∏–º";
  let photo = tg.initDataUnsafe.user.photo_url || "";
  
  // –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  fetch("https://your-backend-url.com/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      user_id: userId,
      name: name,
      faculty: "–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π",
      gender: "–ú",
      photo_url: photo
    })
  });

  // –®–∞–≥ 2: –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∫–µ—Ç—ã –¥—Ä—É–≥–∏—Ö
  function loadProfiles() {
    fetch("https://your-backend-url.com/get_profiles?user_id=" + userId)
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("profileContainer");
        container.innerHTML = "";

        if (data.length === 0) {
          container.innerHTML = "<p>–ù–æ–≤—ã—Ö –∞–Ω–∫–µ—Ç –ø–æ–∫–∞ –Ω–µ—Ç üôÉ</p>";
          return;
        }

        data.forEach(profile => {
          const div = document.createElement("div");
          div.className = "profile";
          div.innerHTML = `
            <img src="${profile.photo_url || 'https://placehold.co/100'}" width="100" style="border-radius: 50%;" /><br/>
            <strong>${profile.name}</strong><br/>
            ${profile.faculty}<br/><br/>
            <button class="btn" onclick="like('${profile.user_id}')">‚ù§Ô∏è –ù—Ä–∞–≤–∏—Ç—Å—è</button>
          `;
          container.appendChild(div);
        });
      });
  }

  loadProfiles();

  // –®–∞–≥ 3: –õ–∞–π–∫
  function like(likedId) {
    fetch("https://your-backend-url.com/like", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        user_id: userId,
        liked_user_id: likedId
      })
    })
    .then(res => res.json())
    .then(data => {
      if (data.match) {
        alert(`MATCH! ü•≥ –í—Å—Ç—Ä–µ—á–∞:\n${data.meeting.place}\n${data.meeting.date} –≤ ${data.meeting.time}`);
      }
      loadProfiles(); // –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π
    });
  }
</script>

</body>
</html>
